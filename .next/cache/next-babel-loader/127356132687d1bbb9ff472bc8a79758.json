{"ast":null,"code":"var _jsxFileName = \"C:\\\\Code\\\\Projects\\\\projectU\\\\projectu\\\\components\\\\Layout.js\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from 'react';\nimport { setCurrentUser, setPendingNotifications, setCurrentUserNotifications } from '../redux/reducers/currentUser';\nimport { setToken } from '../redux/reducers/token';\nimport { connect } from 'react-redux';\nimport { BrowserRouter as Router, Route } from 'react-router-dom';\nimport { useQuery } from '@apollo/react-hooks';\nimport NavBar from './navBar/NavBar';\nimport { FIND_USER, PENDING_NOTIFS, LIST_OF_NOTIFICATIONS } from '../src/schemas/queries';\nimport { bindActionCreators } from 'redux';\nimport Head from 'next/head';\n\nconst Layout = props => {\n  if (true) return __jsx(\"div\", {\n    className: \"wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 14,\n      columnNumber: 9\n    }\n  }, __jsx(Head, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 15,\n      columnNumber: 13\n    }\n  }, __jsx(\"title\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 16,\n      columnNumber: 17\n    }\n  }, \"Unilous test\"), __jsx(\"meta\", {\n    name: \"og:title\",\n    content: \"Unilous test\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 17,\n      columnNumber: 17\n    }\n  })), __jsx(NavBar, {\n    query: query,\n    onQueryChange: onQueryChange,\n    noUser: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 19,\n      columnNumber: 13\n    }\n  }), props.children);else {\n    if (localStorage.getItem('token') && props.token === null) {\n      props.setToken(localStorage.getItem('token'));\n    }\n\n    const currentUserId = props.currentUser ? props.currentUser._id : 'thisisfake';\n    const pendingNotifsQuery = useQuery(PENDING_NOTIFS, {\n      variables: {\n        userId: currentUserId\n      }\n    });\n    const currentUserUN = localStorage.getItem('username') ? localStorage.getItem('username') : 'thisisfake';\n    const userQuery = useQuery(FIND_USER, {\n      variables: {\n        username: currentUserUN\n      }\n    });\n    const userNotifs = props.currentUser ? props.currentUser.notifications.map(n => n._id) : [];\n    const notifsQuery = useQuery(LIST_OF_NOTIFICATIONS, {\n      variables: {\n        notifications: userNotifs\n      }\n    });\n\n    const notifsQueryConditions = () => {\n      if (!notifsQuery.data) return null;\n      if (!props.currentUser) return null;\n      if (notifsQuery.loading) return null;\n      if (notifsQuery.data.listOfNotifications.length < 1) return null;\n      if (!props.currentUser.notifications.length) return null;\n      if (props.currentUser.notifications[0].userFrom) return null;\n      return notifsQuery.data.listOfNotifications;\n    };\n\n    const pendingNotifsConditions = () => {\n      if (!pendingNotifsQuery.data) return null;\n      if (props.currentUser && props.currentUser.pendingNotifications) return null;\n      return pendingNotifsQuery.data.searchAwaitingNotifs;\n    };\n\n    const userConditions = (query, reducer) => {\n      if (!query.data) return null;\n      if (!query.data.findUser) return null;\n      if (reducer) return null;\n      return query.data.findUser;\n    };\n\n    const notifsFilled = notifsQueryConditions();\n    const pendingNotifs = pendingNotifsConditions();\n    const user = userConditions(userQuery, props.currentUser);\n    useEffect(() => {\n      if (user) {\n        props.setCurrentUser(user);\n      }\n\n      if (pendingNotifs) {\n        props.setPendingNotifications(pendingNotifs);\n      }\n\n      if (notifsFilled) {\n        props.setCurrentUserNotifications(notifsFilled);\n      }\n    }, [notifsFilled, props.setCurrentUserNotifications, user, props.setCurrentUser, pendingNotifs, props.setPendingNotifications, props]);\n    return __jsx(\"div\", {\n      className: \"wrapper\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 13\n      }\n    }, __jsx(Head, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 17\n      }\n    }, __jsx(\"title\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 21\n      }\n    }, \"Unilous test\"), __jsx(\"meta\", {\n      name: \"og:title\",\n      content: \"Unilous test\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 21\n      }\n    })), __jsx(NavBar, {\n      query: query,\n      onQueryChange: onQueryChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 17\n      }\n    }), props.children);\n  }\n};\n\nconst mapStateToProps = state => {\n  return {\n    token: state.token,\n    currentUser: state.currentUser\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    setToken: bindActionCreators(setToken, dispatch),\n    setCurrentUser: bindActionCreators(setCurrentUser, dispatch),\n    setPendingNotifications: bindActionCreators(setPendingNotifications, dispatch),\n    setCurrentUserNotifications: bindActionCreators(setCurrentUserNotifications, dispatch)\n  };\n};\n\nsetCurrentUser;\nsetPendingNotifications;\nexport default connect(mapStateToProps, mapDispatchToProps)(Layout);","map":{"version":3,"sources":["C:/Code/Projects/projectU/projectu/components/Layout.js"],"names":["React","useState","useEffect","setCurrentUser","setPendingNotifications","setCurrentUserNotifications","setToken","connect","BrowserRouter","Router","Route","useQuery","NavBar","FIND_USER","PENDING_NOTIFS","LIST_OF_NOTIFICATIONS","bindActionCreators","Head","Layout","props","query","onQueryChange","children","localStorage","getItem","token","currentUserId","currentUser","_id","pendingNotifsQuery","variables","userId","currentUserUN","userQuery","username","userNotifs","notifications","map","n","notifsQuery","notifsQueryConditions","data","loading","listOfNotifications","length","userFrom","pendingNotifsConditions","pendingNotifications","searchAwaitingNotifs","userConditions","reducer","findUser","notifsFilled","pendingNotifs","user","mapStateToProps","state","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\r\nimport { setCurrentUser, setPendingNotifications, setCurrentUserNotifications } from '../redux/reducers/currentUser'\r\nimport { setToken } from '../redux/reducers/token'\r\nimport { connect } from 'react-redux'\r\nimport { BrowserRouter as Router, Route } from 'react-router-dom'\r\nimport { useQuery } from '@apollo/react-hooks'\r\nimport NavBar from './navBar/NavBar'\r\nimport { FIND_USER, PENDING_NOTIFS, LIST_OF_NOTIFICATIONS } from '../src/schemas/queries'\r\nimport {bindActionCreators} from 'redux'\r\nimport Head from 'next/head'\r\n\r\nconst Layout = (props) => {\r\n    if (typeof window === 'undefined') return (\r\n        <div className=\"wrapper\">\r\n            <Head>\r\n                <title>Unilous test</title>\r\n                <meta name=\"og:title\" content=\"Unilous test\" />\r\n            </Head>\r\n            <NavBar query={query} onQueryChange={onQueryChange} noUser />\r\n            {props.children}\r\n        </div>\r\n    )\r\n    else {\r\n        if (localStorage.getItem('token') && props.token === null) {\r\n        props.setToken(localStorage.getItem('token'))\r\n        }\r\n        const currentUserId = props.currentUser ? props.currentUser._id : 'thisisfake'\r\n        const pendingNotifsQuery = useQuery(PENDING_NOTIFS, {\r\n            variables:  {userId: currentUserId}\r\n        })\r\n        const currentUserUN = localStorage.getItem('username') ? localStorage.getItem('username') : 'thisisfake'\r\n        const userQuery = useQuery(FIND_USER, {\r\n            variables: {username: currentUserUN}\r\n        })\r\n        const userNotifs = props.currentUser ? props.currentUser.notifications.map(n => n._id) : []\r\n        const notifsQuery = useQuery(LIST_OF_NOTIFICATIONS, {\r\n            variables: {notifications: userNotifs}\r\n        })\r\n        const notifsQueryConditions = () => {\r\n            if (!notifsQuery.data) return null\r\n            if (!props.currentUser) return null\r\n            if (notifsQuery.loading) return null\r\n            if (notifsQuery.data.listOfNotifications.length < 1) return null\r\n            if (!props.currentUser.notifications.length) return null\r\n            if (props.currentUser.notifications[0].userFrom) return null\r\n            return notifsQuery.data.listOfNotifications\r\n        }\r\n        const pendingNotifsConditions = () => {\r\n            if (!pendingNotifsQuery.data) return null\r\n            if (props.currentUser && props.currentUser.pendingNotifications) return null\r\n            return pendingNotifsQuery.data.searchAwaitingNotifs\r\n        }\r\n        const userConditions = (query, reducer) => {\r\n            if (!query.data) return null\r\n            if (!query.data.findUser) return null\r\n            if (reducer) return null\r\n            return query.data.findUser\r\n        }\r\n        const notifsFilled = notifsQueryConditions()\r\n        const pendingNotifs = pendingNotifsConditions()\r\n        const user = userConditions(userQuery, props.currentUser)\r\n        useEffect(() => {\r\n            if (user) {\r\n                props.setCurrentUser(user)\r\n            }\r\n            if (pendingNotifs) {\r\n                props.setPendingNotifications(pendingNotifs)\r\n            }\r\n            if (notifsFilled) {\r\n                props.setCurrentUserNotifications(notifsFilled)\r\n            }\r\n        }, [notifsFilled, props.setCurrentUserNotifications, user, props.setCurrentUser, pendingNotifs, props.setPendingNotifications, props])\r\n    \r\n        return (\r\n            <div className=\"wrapper\">\r\n                <Head>\r\n                    <title>Unilous test</title>\r\n                    <meta name=\"og:title\" content=\"Unilous test\" />\r\n                </Head>\r\n                <NavBar query={query} onQueryChange={onQueryChange} />\r\n                {props.children}\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n\treturn {\r\n        token: state.token,\r\n        currentUser: state.currentUser\r\n\t}\r\n}\r\nconst mapDispatchToProps = (dispatch) => {\r\n    return {\r\n        setToken: bindActionCreators(setToken, dispatch),\r\n        setCurrentUser: bindActionCreators(setCurrentUser, dispatch),\r\n        setPendingNotifications: bindActionCreators(setPendingNotifications, dispatch),\r\n        setCurrentUserNotifications: bindActionCreators(setCurrentUserNotifications, dispatch),\r\n    }\r\n}\r\nsetCurrentUser\r\nsetPendingNotifications\r\n\r\nexport default connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n)(Layout)"]},"metadata":{},"sourceType":"module"}